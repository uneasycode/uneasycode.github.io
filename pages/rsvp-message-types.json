{
  "title": "RSVP Message Types & Fast Reroute",
  "category": "Advanced",
  "description": "Deep dive into RSVP message flows and link protection fast reroute mechanisms in MPLS networks",
  "tags": [
    "RSVP",
    "MPLS",
    "Fast Reroute",
    "Traffic Engineering"
  ],
  "content": "\n# RSVP Message Types and Link Protection Fast Reroute\n\n**Understanding RSVP message types is crucial for troubleshooting MPLS Traffic Engineering tunnels. When link protection is enabled, specific message flows occur during failures that network engineers must understand.**\n\n## RSVP Message Types Overview\n\nRSVP uses several message types to establish, maintain, and tear down LSP tunnels:\n\n### **Primary Messages**\n- **PATH**: Sent downstream from headend to tailend to establish path state\n- **RESV**: Sent upstream from tailend to headend to make reservations\n- **PathTear**: Tears down path state (downstream direction)\n- **ResvTear**: Tears down reservation state (upstream direction)\n\n### **Error and Confirmation Messages**\n- **PathErr**: Reports path-related errors (sent upstream)\n- **ResvErr**: Reports reservation-related errors (sent downstream)\n- **ResvConf**: Confirms successful reservation (sent downstream)\n\n## Message Flow During Normal Operation\n\n### **1. LSP Establishment**\n\n```bash\n# Normal LSP setup sequence\n1. Headend \u2192 PATH message \u2192 Tailend\n2. Tailend \u2192 RESV message \u2192 Headend\n3. LSP established and operational\n```\n\n**Sample PATH message debug output:**\n```bash\nRouter# debug ip rsvp messages\n\n*Oct  7 10:15:23.456: RSVP: 10.1.1.1_1->10.5.5.5_1[10.1.1.1]: \n  Sending Path message to 192.168.12.2\n*Oct  7 10:15:23.456: RSVP-PATH: building hop object with src addr: 192.168.12.1\n*Oct  7 10:15:23.456: RSVP: session 10.5.5.5_1[10.1.1.1]: \n  Path message sent successfully\n```\n\n**Sample RESV message debug output:**\n```bash\n*Oct  7 10:15:23.892: RSVP: session 10.5.5.5_1[10.1.1.1]: \n  Received Resv message from 192.168.23.3 (on GigabitEthernet0/1)\n*Oct  7 10:15:23.892: RSVP-RESV: Admitting new reservation: 1132CE2C\n*Oct  7 10:15:23.893: RSVP-RESV: reservation was installed: 1132CE2C\n*Oct  7 10:15:23.893: %LINEPROTO-5-UPDOWN: Line protocol on Interface Tunnel1, changed state to up\n```\n\n### **2. Periodic Refresh**\n\n```bash\n# RSVP soft-state refresh (default 30 seconds)\n*Oct  7 10:15:53.456: RSVP: 10.1.1.1_1->10.5.5.5_1[10.1.1.1]: \n  Path refresh, Event: periodic refresh\n*Oct  7 10:15:53.892: RSVP: 10.1.1.1_1->10.5.5.5_1[10.1.1.1]: \n  Resv refresh, Event: periodic refresh\n```\n\n## Link Protection Fast Reroute Configuration\n\n### **Enable Fast Reroute on Primary Tunnel**\n\n```bash\n# Headend router configuration\nRouter(config)# interface tunnel 100\nRouter(config-if)# tunnel destination 10.5.5.5\nRouter(config-if)# tunnel mpls traffic-eng path-option 1 explicit name PRIMARY_PATH\nRouter(config-if)# tunnel mpls traffic-eng fast-reroute  # Enable FRR\n```\n\n### **Configure Backup Tunnel**\n\n```bash\n# Point of Local Repair (PLR) configuration\nRouter(config)# interface tunnel 200\nRouter(config-if)# tunnel mode mpls traffic-eng\nRouter(config-if)# tunnel destination 10.3.3.3  # Merge Point (MP)\nRouter(config-if)# tunnel mpls traffic-eng path-option 1 explicit name BACKUP_PATH\n\n# Assign backup tunnel to protect interface\nRouter(config)# interface GigabitEthernet0/1\nRouter(config-if)# mpls traffic-eng backup-path tunnel 200\n```\n\n### **Verify Fast Reroute Status**\n\n```bash\n# Check FRR protection status\nRouter# show mpls traffic-eng fast-reroute database\n\nLSP Head: 10.1.1.1, Tunnel ID: 100, LSP ID: 1\n  Output Interface: GigabitEthernet0/1, PHop: 10.2.2.2\n  FRR Protection: Requested\n  Backup Interface: Tunnel200, NHop: 10.4.4.4\n  Status: Protected\n```\n\n## Message Flow During Link Failure\n\nWhen a protected link fails, the following message sequence occurs:\n\n### **Phase 1: Failure Detection and Fast Reroute Activation**\n\n```bash\n# Interface goes down - immediate detection\n*Oct  7 10:20:15.123: %LINK-3-UPDOWN: Interface GigabitEthernet0/1, changed state to down\n*Oct  7 10:20:15.124: RSVP-FRR: Activating backup tunnel 200 for LSP 10.1.1.1_100\n*Oct  7 10:20:15.124: MPLS-TE-FRR: Protected LSP 10.1.1.1_100 switched to backup path\n```\n\n### **Phase 2: Error Signaling**\n\n```bash\n# PathErr sent upstream to headend\n*Oct  7 10:20:15.125: RSVP: 10.1.1.1_100->10.5.5.5_1[10.1.1.1]: \n  Sending PathErr message to 192.168.12.1\n*Oct  7 10:20:15.125: RSVP-PERR: Error Code: 24 (Routing Problem)\n*Oct  7 10:20:15.125: RSVP-PERR: Error Value: 1 (Bad Explicit Route)\n```\n\n### **Phase 3: Headend Reroute**\n\n```bash\n# Headend receives PathErr and initiates reroute\n*Oct  7 10:20:15.456: RSVP: session 10.5.5.5_1[10.1.1.1]: \n  Received PathErr message from 192.168.12.2\n*Oct  7 10:20:15.456: RSVP-PATH: PathErr received, initiating reroute\n*Oct  7 10:20:15.457: MPLS-TE: Tunnel100 - trying to come up on secondary path-option\n*Oct  7 10:20:15.458: RSVP: 10.1.1.1_100->10.5.5.5_1[10.1.1.1]: \n  Sending new PATH message via alternate route\n```\n\n## Troubleshooting Commands\n\n### **Monitor RSVP Messages**\n\n```bash\n# Debug RSVP message processing\nRouter# debug ip rsvp messages\nRouter# debug mpls traffic-eng fast-reroute events\n\n# Show current RSVP sessions\nRouter# show ip rsvp sender\nRouter# show ip rsvp reservation\n\n# Check FRR database\nRouter# show mpls traffic-eng fast-reroute database\nRouter# show mpls traffic-eng fast-reroute log reroutes\n```\n\n### **Verify Message Flows**\n\n```bash\n# Check RSVP neighbor states\nRouter# show ip rsvp neighbor\n\n# Verify tunnel status\nRouter# show mpls traffic-eng tunnel summary\nRouter# show mpls traffic-eng tunnel detail\n\n# Monitor path changes\nRouter# show mpls traffic-eng topology path destination 10.5.5.5\n```\n\n## Common Message Flow Scenarios\n\n### **Scenario 1: Successful FRR Protection**\n1. **Link failure detected** \u2192 Interface down\n2. **Traffic switched** \u2192 Backup tunnel activated\n3. **PathErr sent** \u2192 Upstream to headend\n4. **Headend reroutes** \u2192 New PATH via alternate route\n5. **New RESV received** \u2192 LSP re-established\n\n### **Scenario 2: No Protection Available**\n1. **Link failure detected** \u2192 Interface down\n2. **No backup tunnel** \u2192 Traffic dropped\n3. **PathTear/ResvTear** \u2192 LSP torn down completely\n4. **Headend calculates new path** \u2192 Full reroute\n5. **New LSP established** \u2192 Longer convergence time\n\n### **Scenario 3: Backup Tunnel Failure**\n1. **Primary link fails** \u2192 FRR activates\n2. **Backup tunnel fails** \u2192 Secondary failure\n3. **Multiple PathErr messages** \u2192 Error cascade\n4. **LSP tears down** \u2192 Complete failure\n5. **Headend must find alternative** \u2192 Manual intervention may be needed\n\n## Key Takeaways\n\n- **RSVP uses soft state** - periodic refresh messages maintain LSP state\n- **Fast Reroute provides sub-50ms protection** - local repair at point of failure\n- **PathErr messages trigger headend reroute** - optimize path after FRR activation\n- **Backup tunnels must be pre-established** - protection requires planning\n- **Message debugging is crucial** - understand flow for effective troubleshooting\n\n**Pro Tip:** Always monitor both the data plane (traffic flow) and control plane (RSVP messages) when troubleshooting MPLS TE issues. The message flows tell you exactly what RSVP is thinking during failures and recoveries.\n"
}